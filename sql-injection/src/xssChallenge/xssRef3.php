<!DOCTYPE html>
<html lang="en">
<title> XSS-Injection</title>

<head>

    <link rel="stylesheet" href="../css/Style.css">
</head>

<body>

    <form action="xssRef3.php" method="POST" id="f">

        <input type="checkbox" id="flag" name="check">
        <input type="checkbox" id="solution" name="hint1" />

        <div class=" title">

            <div style="margin: 3px 755px;font-size: 16px; position: absolute; "><a href="http://localhost"
                    style="text-decoration: none;"> <span style="color :#0c2461; ">Home</span></a></div>
            <div style="margin: 5px 825px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:5000/command_injection_1" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">Command-Injection</span></a></div>
            <div style="margin: 5px 975px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:3000" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">Path-Traversal</span></a></div>
            <div style="margin: 5px 1090px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:8026" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">SQL-Injection</span></a></div>
            <div style="margin: 5px 1200px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:8026/xssMain.php" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">XSS-Injection</span></a></div>

            <h1 style="padding: 0px 44px;font-size: 20px; text-align:left;"> Web-Exploitation-Demos
            </h1>
        </div>

        <div class="box">
            <h1> XSS-Injection</h1>
            <ul>
                <li>
                    <a href="../../Einleitung/einleitung2.php" style="text-decoration:none;"><span
                            style="color :#0c2461; text-decoration:none;">Einleitung</span></a>
                </li>

                <li><a href="xssRef1.php" style="color :#0c2461; text-decoration:none;">(1) Reflektiertes XSS</a>

                </li>
                <li>
                    <a href="../challRepariert/xssChall1.php" style="text-decoration: none;"><span
                            style="color:#0c2461">
                            (1)
                            Challenge geschützt</span></a>
                </li>
                <li><span style="color:#0c2461"> (2) Persistentes XSS </span>
                    <label for="flag" class="flag3"> Persistentes XSS Persistentes XSS </label>
                </li>
                <li>
                    <a href="challRepariert/xssChall2.php" style="text-decoration: none;"><span style="color:#0c2461">
                            (2)
                            Challenge geschützt</span></a>
                </li>
            </ul>

        </div>

        <div class="Rahmen">

            <?php

            $flag = trim($_POST['flag_eingabe']);
            if ($flag == "done_Ref26254" && (isset($_POST['flag_btn']))) {
                echo ' <script type="text/javascript">
                 window.location.href = "/xssChallenge/xssPers1.php";
                   </script>';
            }
            if ($flag == "done_Ref26254" | isset($_POST['flag_btn'])) {
                echo '<span style="color:red; text-align: center; margin: 27px 13px; font-size: 13px;position: absolute; ">Ungültige Eingabe</span>';
            }

            ?>
            <div>
                <p style="color:blue; margin:10px 160px;position: absolute;"> Challenge 1: Demonstration einer
                    reflektierten XSS-Injection </p>
            </div>
            <div>
                <p style="position: absolute;margin: 52px 40px;font-size: 14px;"> Diese Challenge ist aufeinander in
                    drei
                    Stufen aufgebaut. Zu einer anderen Stufe zu gelangen, muss ein Code im Textfeld eingegeben
                    werden. Einen Code bekommst du, wenn du die jeweils vorherige Stufe gelöst hast. </p></br><br><br>
            </div>
            <div>
                <p style="margin: 35px 41px;font-size: 14px;"> Nachdem alle drei Stufen gelöst wurden, erhältst du die
                    Flag
                    für die nächste Challenge "Persistentes XSS".</p>
            </div>

            <div
                style="margin: -15px 90px; background-color: #06f206bf;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <a href="xssRef1.php" style=" color:black; margin: 17px 30px; position: absolute; "> Einfach</a>
            </div>
            <div
                style="margin: -15px 240px; background-color:  #06f206bf;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <a href="xssRef2.php" style=" color:black;position:absolute; margin:17px 38px;">Mittel</a>
            </div>
            <div
                style="margin: -15px 390px; background-color: #06f20659;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <span style=" color:black;position:absolute; margin:17px 33px;">Schwer</span>
            </div>
            <div
                style="margin: -15px 540px; background-color: #898e863d;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <label for="solution" style=" color:black;position:absolute; margin:17px 27px;">Lösungen</label>
            </div>
            <div class="deco_rahmen" style="height: 392px;">
                <div class="inhalt_rahmen" style="height: 370px;">


                    <div style="background-color: #0000001a;height: 180px;margin: 44px 32px;width: 820px;">
                        <div
                            style="background-color: white;position: absolute;height: 160px;width: 800px;margin: 10px 10px;">
                            <?php
                            echo  '<span style="position: absolute;width: 750px;margin: 19px 32px;" ><strong>Stufe 3:</strong> Um solche Angriffe zu vermeiden, hat der Entwickler das script-Tag blockiert. <br><br>Finde Wege, die  ein Popup <strong> Code </strong> anzeigen.</span>' . "<br><br>";

                            ?>
                        </div>
                    </div>
                    <?php
                    $text = trim($_POST['text']);

                    $aufgabe1 = "<script>alert('Code')</script>";
                    $aufgabe2 = "<script> alert('Code')</script>";
                    $aufgabe3 = "<img src=x onerror=alert('Code')>";

                    if ($text == str_replace("<script>", "", $text)) {
                        echo $text . "<br><br><br><br>";
                    } else {
                        $ab = str_replace('<script>', '', $text);
                        // $abc = str_replace(' <script>', '', $text);
                        echo  $ab . "<br><br><br><br>";
                    }
                    if ($text == $aufgabe3 | $ab == $aufgabe2 | $ab == $aufgabe1) {

                        $curl = curl_init();
                        curl_setopt($curl, CURLOPT_URL, "http://main-website:3000/check-flag");
                        curl_setopt($curl, CURLOPT_POST, true);
                        curl_setopt($curl, CURLOPT_POSTFIELDS, "challenge_name=XSS-injection_level-1&challenge_flag=done_Ref26254");
                        curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
                        $output = curl_exec($curl);
                        curl_close($curl);
                        $Confirmation = "<script> window.confirm('Glückwünsch! Flag fuer naechste Challenge 2: done_Ref26254');   </script>";
                        if ($Confirmation == true) {
                            echo $Confirmation;
                        }
                        echo '<p style="font-size:20px; position: absolute;margin: -101px 152px;width:600px;"><strong style="color:green;"> Flag fuer persistente Challenge ist done_Ref26254 </strong></p>';
                        if ($text == $aufgabe3) {

                            echo '<div style="margin: -434px 380px; background-color: #06f206bf;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
            <span style=" color:black;position:absolute; margin:17px 33px;">Schwer</span> </div>';
                        } elseif ($ab == $aufgabe2 | $ab == $aufgabe1) {

                            echo '<div style="margin: -425px 380px; background-color: #06f206bf;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
            <span style=" color:black;position:absolute; margin:17px 33px;">Schwer</span> </div>';
                        }
                    }
                    ?>
                    <p style="margin: -47px 10px;"> Antwort absenden: </p>
                    <input type="text" name="text" style="position: absolute;margin: 22px 167px;">
                    <button type="submit" name="submit"
                        style="color:blue;position: absolute;margin: 25px 397px;width: 178px;">Eingabe
                        absenden</button>

                </div>
            </div>
        </div>
        <div class="flag_popup">
            <div class="flag_eingabe">
                <input type="text" id="flag_text" name="flag_eingabe" autocomplete="off"
                    placeholder="Geben sie Flag ein:" style="width: 322px;height: 40px; margin: 1px 20px; ">
            </div>
            <div class="flag_btn">
                <input type="submit" name="flag_btn" value="submit"
                    style="  height: 40px;width: 350px; margin: 10px 30px;
                    background: #00dbff52; border-top-right-radius: 10px; border-top-left-radius: 10px;border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;">
            </div>
        </div>
        <div class="hint" style="position: unset;margin: -46px -288px;">
            <ul>
                <li>
                    <p style="margin: 3px 13px;">Hinweis1</p>
                    <div class="content">

                        <p style="margin: 45px -4px;"> Du hast die Möglichkeiten diese Stufe mit oder ohne script-Tag zu
                            lösen.
                        </p>
                    </div>

                </li>
                <li>
                    <p style="margin: 3px 13px;">Hinweis2</p>
                    <div class="content">

                        <p style="margin: -7px -4px;"> Hinweis mit script-Tag: <br><br> Script-Tag Blockieren bedeutet
                            nicht, dass diese Website nicht angreifbar ist, es bedeutet nur, dass die Nutzlast verborgen
                            wird, um einer Erkennung zu entgehen.

                        </p>
                    </div>

                </li>
                <li>
                    <p style="margin: 3px 13px;">Hinweis3</p>
                    <div class="content" style="height: 318px;">

                        <p style="margin: -2px -4px;"> Hinweis ohne script-Tag:<br><br> -> Die Zeichen „<>“ dienen dazu,
                                das aktuelle HTML-Tag zu umgehen. <br> -> Wenn du auf „< img src=x“ verweisen, führt
                                    dies zu einem Fehler, da die Anwendung die Ressource x nicht finden kann. Dies
                                    geschieht absichtlich, um den Ereignis-Handler onerror zu nutzen. <br> -> alert(),
                                    das als Nachweis dafür dient, dass das Skript ausgeführt wurde.

                        </p>
                    </div>

                </li>
                <li>
                    <p style="margin: 3px 13px;">Hinweis4</p>
                    <div class="content">

                        <p style="margin: 35px -14px;"> Setze den String zwischen zwei ''. Zum Beispiel
                            'Hallo'.
                        </p>
                    </div>

                </li>
            </ul>
        </div>
        <div class="Solution" style="margin: 385px 15px;">
            <p style="margin: 20px 30px"> Stufe 3: <br><br> 1)<?php $str = "<scri<script>pt> alert('Code')</script>";
                                                                echo htmlentities($str); ?> <br><br> 2)
                <?php $str = " <img src=x onerror=alert('Code')>";
                echo htmlentities($str); ?>

                <br><br>
            </p>
        </div>
    </form>
    <form action="../xssMain.php" method="POST" style="width: 0px; height:0px; margin:0px 0px;">

        <div class="back" style="margin: 23px -445px;"><input type="submit" name="back1"
                value="Zurück zur Challenge-Seite" style="    background: none;   border: none;color: Blue;"></div>
    </form>

    <body>
        <html>