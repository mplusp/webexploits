<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <base href="http://localhost:8026" />
    <link rel="stylesheet" href="/css/style.css">

</head>

<body>

    <form action="index.php" method="GET">
        <input type="radio" id="hint1" name="check" />
        <input type="radio" id="hint2" name="check" />
        <input type="radio" id="hint3" name="check" />
        <input type="radio" id="hint4" name="check" />
        <input type="radio" id="hint5" name="check" />
        <input type="radio" id="hint6" name="check" />
        <input type="radio" id="hint7" name="check" />
        <input type="radio" id="hint8" name="check" />

        <div class=" title">
            <div class="inhalt">
                <div style="margin: 3px 605px;font-size: 16px; position: absolute; "><a href="http://localhost"
                        style="text-decoration: none;"> <span style="color :#0c2461; ">Home</span></a></div>
                <div style="margin: 5px 677px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:5000/command_injection_1" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">Command-Injection</span></a></div>
                <div style="margin: 5px 830px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:3000" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">Path-Traversal</span></a></div>
                <div style="margin: 5px 953px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:8026" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">SQL-Injection</span></a></div>
                <div style="margin: 5px 1063px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:8026/xssMain.php" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">XSS-Injection</span></a></div>

                <h1 style="padding: 0px 44px;font-size: 20px;"> Web-Exploitation-Demos</h1>
            </div>
        </div>

        <div class="box">
            <h1> SQL-Injection</h1>
            <ul>
                <li>
                    <a href="Einleitung/einleitung1.php" style="text-decoration:none;"><span
                            style="color :#0c2461; text-decoration:none;">Einleitung</span></a>
                </li>
                <li><a href="index.php" style="text-decoration: none;"><span style="color:#0c2461"> (1) Angreifbare
                            Login-Seite
                        </span></a>
                </li>

                <li>
                    <a href="challRepariert/chall1.php" style="text-decoration: none;"><span style="color:#0c2461">
                            (1) Challenge geschützt </span></a>
                </li>
                <li><a href="backSql2.php" style="text-decoration: none;"><span style="color:#0c2461"> (2)
                            Union-Injection </span></a>
                <li>
                    <?php


                    echo "<a style='text-decoration: none;' href =\"challRepariert/chall2.php?id=1" . "\"  ><span
style='color:#0c2461'> (2) Challenge geschützt</span></a>";

                    ?>
                </li>
            </ul>
        </div>



        <div class="rahmen" style="width: 676px;margin: -300px 439px;">

            <div class="box">

                <div class="auswahl">
                    <?php

                    echo '<div ><strong><span style=" color:blue; font-size:16px;margin: 14px -170px;position: absolute;"">Challenge 2: Unberechtigter Datenzugriff </strong></div>';
                    echo "<br/>";
                    echo '<div style="color: black; text-align: left; margin: 10px 13px; font-size: 12px;position: absolute;  width: 670px;"><p > In dieser Challenge wird die Herausforderung durch das Manipulieren der URL durchgeführt. Die Hinweise helfen dir alle Herausforderungen schrittweise zu bewältigen.<br><br> Sobald du den richtigen Umsatz berechnet hast, hast du die SQL-Injection-Challenges erfolgreich abgeschlossen. </p></div>';
                    echo '<div style="color: black; text-align: left; margin: -133px 203px; font-size: 14px;position: absolute;  width: 315px;"><strong style ="margin: 411px -186px; position: absolute;">1. Bestimme die genaue Anzahl der Spalten in der Datenbank. </strong></div>';

                    echo '<div class ="hints" style="margin: 304px 60px;width:91px"> <label for="hint1" id="hinweis"class="begin">Hinweis 1.1</label>  </div>';
                    echo '<div class ="hints"style="margin: 304px 190px;width:91px"> <label for="hint2" id="hinweis"class="begin">Hinweis 1.2</label>  </div>';
                    echo '<div class ="hints"style="margin: 304px 320px;width:91px">  <label for="hint3" id="hinweis" class="begin">Hinweis 1.3</label>  </div>';
                    echo '<div class ="hints"style="width:91px;padding: 0px 15px;text-align: end;"> <label id="hinweis" for="hint4" class="begin" style="margin: 327px -88px;">Hinweis 2.1</label></div>';
                    echo '<div class ="hints"style="width:91px;padding: 0px 15px;text-align: end;"> <label id="hinweis" for="hint5" class="begin" style="margin: 327px 42px;">Hinweis 2.2</label></div>';
                    echo '<div class ="hints"style="width:91px;padding: 0px 15px;text-align: end;"> <label id="hinweis" for="hint6" class="begin" style="margin: 327px 172px;">Hinweis 2.3</label></div>';
                    echo '<div class ="hints"style="width:91px;padding: 0px 15px;text-align: end;"> <label id="hinweis" for="hint7" class="begin" style="margin: 400px -88px;">Hinweis 3.1</label></div>';
                    echo '<div class ="hints"style="width:91px;padding: 0px 15px;text-align: end;"> <label id="hinweis" for="hint8" class="begin" style="margin: 400px 42px;">Hinweis 3.2</label></div>';


                    ?>
                </div>
            </div>
        </div>

        <div class="hints_u1"><span><strong> Hinweis 1.1:</strong> Wenn eine URL möglicherweise mit ? = endet und
                mit einer Datenbank kommuniziert wird, dann kannst du es ausnutzen. </br></br> - Um zu prüfen, ob die
                Website für SQL-Injection geeignet ist, füge einfach ein ' am Ende der Abfrage ein. Zum
                Beispiel:</br></br> <strong style="margin: 10px 95px;">http://Beispiel-domain/index.php?id=5
                    ′</strong><br><br>Wenn die Anfrage eine Fehlermeldung erfolgt, bedeutet die
                Webseite durch SQL-Injection angreifbar ist. </span>
        </div>
        <div class="hints_u2"><span> <strong>Hinweis 1.2:</strong> </br></br> - Um die genau Anzahl der Spalten zu
                finden, kannst du
                folgende Anfrage ausführen: <br>(n-> Nummer von Spalten) </br></br> <strong
                    style="margin: 10px 25px;">http://Beispiel-domain/index.php?id=5 ORDER BY n .</strong></span>
        </div>
        <div class="hints_u3"><span> <strong>Hinweis 1.3:</strong> Wenn die Ausführung bei der n-ten Spalte eine
                Fehlermeldung zeigt, bedeutet dies n-1 Spalten. </span></div>
        <div class="hints_u4"><span> <strong>Hinweis 2.1:</strong> Wenn du die exakte Anzahl der Spalten kennst, kannst
                du jetzt einfach aller anfälligen Spalten herausfinden. </br></br> Mit dem UNION
                Befehl kann man die Abfrage von zwei oder mehr SELECT’s kombinieren. Zum Beispiel: </br><strong>
                    http://Beispiel-domain/index.php?id=5 UNION SELECT NULL FROM tabelle2 </strong> </span></div>
        <div class="hints_u6"><span> <strong>Hinweis 2.3:</strong> Name der Tabelle2 findest du von der Fehlermeldung
                beim Query. </span></div>
        <div class="hints_u5"><span> <strong>Hinweis 2.2:</strong> Wenn man UNION Operator nutzt, muss die Anzahl der
                Spalten in der Tabelle gleich sein. Ansonsten bekommst du Fehlermeldung. Folgende Operator kannst du
                fuer Ausfuerung nutzen: <br><br><strong> NULL :</strong> Täuscht eine leere Spalte vor <br> <strong>
                    , :</strong> Trennen einer Spalte von einer anderen <br> <strong> 'a' :</strong> Überprüpfung
                einer anfälligen Spalte. <br><br> a - ist biliebig </span></div>
        <div class="hints_u7"><span> <strong>Hinweis 3.1:</strong> Wenn du alle anfälligen Spalten gefunden hast, kannst
                du jetzt Daten aus anderen Tabellen abrufen.<br><br>-Mithilfe von MYSQL aggregierte Funktionen und
                Gruppierung kannst du Daten zugreifen. Dazu gehören zum Beispiel:<br><br><strong>SUM('Spalten_name') :
                </strong>
                Funktion gibt die Summe eines Ausdrucks zurück<br><strong> COUNT('Spalten_name'):</strong>Funktion gibt
                eine
                Anzahl von nicht NULL Werten zurück<br><strong>GROUP_CONCAT('Spalten_name'): </strong> Funktion gibt
                nicht NULL
                String Wert zurück </span></div>
        <div class="hints_u8"><span> <strong> Hinweis 3.2:</strong> Spalten_name findest du aus der Frage. </span></div>

        <div style="position: absolute;margin: -349px 453px;width:663px;">
            <?php include 'sql_conn.php';
            error_reporting(E_ALL & ~E_NOTICE & ~E_ERROR & ~E_WARNING);
            $id = $_GET['id'];
            $a = explode(' ', $id, 2);
            $s = "SELECT * FROM Filiale $a[1]";

            echo '<div style="color: black; text-align: left; margin: 558px -186px; font-size: 14px;position: absolute;  width: 800px;"><strong style ="margin: -240px 184px;position: absolute;">2. Suche nach anfälligen Spalten, die String enthält  </strong></div>';
            echo '<div style="color: black; text-align: left; margin: 632px -186px; font-size: 14px;position: absolute;  width: 850px;"><strong style ="margin: -239px 184px;position: absolute;">3. Wie viele Umsätze haben die Filialen insgesamt gemacht? </strong></div>';
            echo '<br><br><br>';
            $resulti = mysqli_query($conn, $s) or trigger_error("Query Failed! SQL: $s - Error: ");
            if ($resulti) {
                echo '<table width=\"35%\" border=\"1\" cellpadding=\"0\" cellspacing=\"2\" style="line-height: 19px;margin: -63px 10px;" ><tr><th>Filiale</th><th>Standort</th><th>Land</th></tr>';
            } else {
                echo "<br> <br> <strong>Entferne</strong> " . $a[1] . " <strong>von URL. </strong>";
            }

            while ($aus =  $resulti->fetch_object()) {
                if ($aus->Filiale == 480 | $aus->Standort == 480 | $aus->Land == 480) {
                    echo '<strong style="color: green; font-size:15px;position: absolute;margin: -38px 316px;width: 373px;"> Herzlichen Glückwunsch!</strong> <span style="font-size:12px;margin: -20px 273px;position: absolute;width: 510px;">-- SQL-Injection Challenges wurden erfolgreich abgeschlossen.</span> ';
                    $curl = curl_init();
                    curl_setopt($curl, CURLOPT_URL, "http://main-website:3000/check-flag");
                    curl_setopt($curl, CURLOPT_POST, true);
                    curl_setopt($curl, CURLOPT_POSTFIELDS, "challenge_name=sql-injection_level-2&challenge_flag=480");
                    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
                    $output = curl_exec($curl);
                    curl_close($curl);
                }
                echo " <tr>";
                echo "<td align='center'>" . $aus->Filiale . "</td>";
                echo "<td align='center'>"  . $aus->Standort . "</td>";
                echo "<td align='center'>"  . $aus->Land . "</td>";
                echo "<br />";
            }

            echo "</tr>";
            echo "</table>";
            echo "</br> "; ?>
        </div>

    </form>
    <form action="backSql2.php" method="Post" style="position: absolute;background: none;height: 369px;width: 0px;">

        <input type="submit" name="btn" value="Zurück zur Challenge-Seite" style="  height: 40px;width: 350px; margin: 10px 70px;
        background: transparent; border: none;color: #0e42c8;">
    </form>
</body>

</html>