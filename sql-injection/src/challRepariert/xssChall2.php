<!DOCTYPE html>
<html lang="en">
<title> XSS-Injection</title>

<head>

    <link rel="stylesheet" href="../css/Style.css">
</head>

<body>

    <form action="../challRepariert/xssChall2.php" method="POST">

        <input type="checkbox" id="flag" name="check">
        <input type="checkbox" id="solution" name="s" />
        <div class=" title">

            <div style="margin: 3px 755px;font-size: 16px; position: absolute; "><a href="http://localhost"
                    style="text-decoration: none;"> <span style="color :#0c2461; ">Home</span></a></div>
            <div style="margin: 5px 825px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:5000/command_injection_1" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">Command-Injection</span></a></div>
            <div style="margin: 5px 975px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:3000" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">Path-Traversal</span></a></div>
            <div style="margin: 5px 1090px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:8026" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">SQL-Injection</span></a></div>
            <div style="margin: 5px 1200px;font-size: 13px; position: absolute; width:145px;"><a
                    href="http://localhost:8026/xssMain.php" style="text-decoration: none;"> <span
                        style="color :#0c2461; ">XSS-Injection</span></a></div>

            <h1 style="padding: 0px 44px;font-size: 20px; text-align:left;"> Web Exploitation Demos
            </h1>
        </div>


        <div class="box">
            <h1> XSS-Injection</h1>
            <ul>
                <li>
                    <a href="../../Einleitung/einleitung2.php" style="text-decoration:none;"><span
                            style="color :#0c2461; text-decoration:none;">Einleitung</span></a>
                </li>

                <li><a href="../xssChallenge/xssRef1.php" style="color :#0c2461; text-decoration:none;"> (1)
                        Reflektiertes
                        XSS</a>

                </li>
                <li>
                    <a href="../challRepariert/xssChall1.php" style="text-decoration: none;"><span
                            style="color:#0c2461">
                            (1)
                            Challenge geschützt</span></a>
                </li>
                <li><span style="color:#0c2461"> (2) Persistentes XSS </span>
                    <label for="flag" class="flag3"> Persistentes XSS Persistentes XSS </label>
                </li>
                <li>
                    <a href="../challRepariert/xssChall2.php" style="text-decoration: none;"><span
                            style="color:#0c2461">
                            (2)
                            Challenge geschützt</span></a>
                </li>
            </ul>

        </div>

        <div class="Rahmen">


            <div>
                <p style="color:blue; margin:10px 160px;position: absolute;"> Challenge 2: Demonstration einer
                    persistenten XSS-Injection </p>
            </div>
            <div>
                <p style="position: absolute;margin: 52px 40px;font-size: 14px;">Diese Challelge ist aufeinander in 2
                    Stufen aufgebaut. Um von einer zu anderen Stufe zu kommen muss ein Code im Textfeld eingegeben
                    werden. Einen Code bekommst du, wenn du die jeweilige Stufe gelöst hast.</p></br><br><br>
            </div>
            <div>
                <p style="margin: 35px 41px;font-size: 14px;"> Nachdem alle 2 Stufen gelöst wurden, wird XSS-Injection
                    Challenges erfolgreich abgeschlossen.</p>
            </div>
            <div
                style="margin: -15px 90px; background-color: #06f20659;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <span style=" color:black; margin: 17px 30px; position: absolute;"> Einfach</span>
            </div>
            <div
                style="margin: -15px 240px; background-color: #898e863d;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <span style=" color:black;position:absolute; margin:17px 38px;">Mittel</span>
            </div>
            <div
                style="margin: -15px 390px; background-color: #898e863d;box-sizing: border-box;border-radius: 10px;width: 126px;height: 54px;position:absolute;">
                <label for="solution" style=" color:black;position:absolute; margin:17px 27px;">Lösungen</label>
            </div>

        </div>
        <div class="deco_rahmen" style="margin: 189px 452px; height: 520px;">
            <div class="inhalt_rahmen" style="height: 498px;">
                <p style="margin: 15px 100px;"><br>Geben Sie den Code ein: </p> <input type="text" name="code"
                    style="margin: -43px 315px; position:absolute;">

                <button type="submit" name="sub"
                    style="color: green; margin: -39px 544px;position:absolute;">Submit</button>
                <div
                    style="background-color: #0000001a;height: 100px;margin: 30px 32px;width: 820px;position:absolute;">
                    <div
                        style="background-color: white;position: absolute;height: 80px;width: 800px;margin: 10px 10px;">
                        <?php
                        echo  '<span style="position: absolute;width: 780px;margin: 11px 21px;" ><strong> Stufe 1: </strong> Füge eine Nachricht hinzu, die ein Popup mit diener Dokument Cookies anzeigt.</span>' . "<br><br>";
                        ?>
                    </div>
                </div>
                <?php include("../xssChallenge/sqlConn.php");

                $comment = trim($_POST['text']);

                $stufe1 = "<script>alert(document.cookie)</script>";

                if (isset($_POST['submit'])) {

                    if (str_replace("<script>", "", $comment) == false) {
                        $comment = str_replace($comment, '', $comment);
                    } else {
                        $pos = strpos($comment, "<script>");

                        if ($pos !== false) {
                            $comment = str_replace($comment, '', $comment);
                        }
                    }

                    if ($_POST['text'] != "") {
                        $stmt = $conn->prepare("INSERT IGNORE INTO xss ( Comment) VALUES (  ?) ");
                        $stmt->bind_param("s", $comment);
                        $stmt->execute();
                        if ($comment == $stufe1) {
                            $id = mysqli_insert_id($conn);
                        }
                    } else {
                        echo "<br>" . "Nachricht Schreiben!";
                    }
                }


                $update = "UPDATE xss SET Comment='' WHERE id='$id'";

                if ($conn->query($update) === false) {
                    echo "Error updating record: " . $conn->error;
                }

                echo "<br>";


                if ($_POST['code'] == "xssPers1_done" && isset($_POST['sub'])) {
                    $sql = "DELETE from xss where id>2 ";

                    if ($conn->query($sql) != TRUE) {

                        echo "Error deleting record: " . $conn->error;
                    }

                    $conn->close();
                    echo ' <script type="text/javascript">
                                window.location.href = "xssPers2.php";
                                </script>';
                }
                ?>
                <div style="position: absolute;margin: 120px 448px;width: 400px;">
                    <?php
                    $str = "<script>
                alert(1)
                </script>";
                    echo "<strong>Gebe ausführbare XSS-Injection Textcode</strong> " . htmlentities($str) . " <strong>ein.</strong> <br>"; ?>
                </div>
                <div style="background: black;width: 420px;height: 183px;position: absolute;margin: 75px -443px;">
                    <strong style="margin: 12px 25px;position: absolute; font-size:16px;width: 400px;color: white;">
                        Mögliche
                        ergreifbare Schutzmaßnahme:
                    </strong> <br><br>

                    <span
                        style="color:white;text-align: left;font-size: 13px;width: 400px;position: absolute;margin: 5px 25px;">Hier
                        werden die Benutzereingaben genauso überprüft. Wenn Eingaben Script-Tag enthalten, werden sie
                        nicht der Datenbank hinzufügt.
                        Ein Code dafür ist: <br><br>

                        $pos = strpos($comment, "<*script>");<br>
                            $comment = str_replace($comment, '', $comment); <br>
                            - Sobald script-Tag gefunden wird, ersetze den Script-Tag als Leerzeichen.
                    </span>
                </div>
                <span id="comment"><strong style="font-size:30px;margin: 114px 10px;position: absolute;">
                        Comment</strong></span>
                <div><textarea name="text"
                        style="margin: 165px 47px;height: 180px;width: 350px; resize: none;"></textarea></div>
                <div><input type="submit" name="submit" value="Comment"
                        style="width: 356px;margin: -158px 46px;color: blue; position:absolute;"></div>

            </div>
        </div>
        <div class="flag_popup">
            <div class="flag_eingabe">
                <input type="text" id="flag_text" name="flag_eingabe" autocomplete="off"
                    placeholder="Geben sie Flag ein:" style="width: 322px;height: 40px; margin: 1px 20px; ">
            </div>
            <div class="flag_btn">
                <input type="submit" name="flag_btn" value="submit"
                    style="  height: 40px;width: 350px; margin: 10px 30px;
                    background: #00dbff52; border-top-right-radius: 10px; border-top-left-radius: 10px;border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;">
            </div>
        </div>
        <div class="hint" style="margin: -53px -83px;">
            <ul>
                <li>
                    <p style="margin: 3px 13px;">Hinweis1</p>
                    <div class="content">

                        <p style="margin: -7px -4px;"> In Javascript wird am häufigsten eine XSS-Sicherheitslücke
                            <br><br>durch die Javascript-Funktion <br><br>
                            <*script>alert()<* /script> überprüft.<br><br> * - Ohne Leerzeichen
                        </p>
                    </div>

                </li>
                <li>
                    <p style="margin: 3px 13px;">Hinweis2</p>
                    <div class="content">

                        <p style="margin: 54px -4px;"> Vermeide Leerzeichen zwischen den Code.
                        </p>
                    </div>

                </li>

            </ul>
        </div>
        <div>
            <iframe src=" ../xssChallenge/ausgabe.php"
                style="position: absolute;margin: 482px 900px;width: 430px;height: 242px; color: transparent;"></iframe>
        </div>
        <div class="Solution" style="margin: 415px 19px;">
            <p style="margin: 50px 30px">
                Stufe 1<br>
                <?php $str = "<script>alert(document.cookie)</script>";
                echo htmlentities($str); ?> <br><br>
                <br><br>
            </p>
        </div>

    </form>
    <form action="../xssMain.php" method="POST" style="width: 0px; height:0px; margin:0px 0px;">

        <div class="back" style="margin: -12px -560px;position: absolute;"><input type="submit" name="back1"
                value="Zurück zur Challenge Seite" style="   background: none;   border: none;color: Blue;"></div>
    </form>
</body>

</html>