<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Path-Traversal-Challenge</title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
    <link href="/css/custom.css" rel="stylesheet" />
  </head>
  <body class="bg-dark text-light">
    <!-- top navigation -->
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark mt-3">
        <div class="container-fluid">
          <a class="navbar-brand fw-bold" href="#">Web-Exploitation-Demos</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-link" href="http://localhost">Home</a>
              <a
                class="nav-link"
                href="http://localhost:5000/einfuehrung_in_command_injection"
                >Command-Injection</a
              >
              <a class="active nav-link" href="http://localhost:3000"
                >Path-Traversal</a
              >
              <a class="nav-link" href="http://localhost:8026">SQL-Injection</a>
              <a class="nav-link" href="http://localhost:8026/xssMain.php"
                >XSS (Cross-Site-Scripting)</a
              >
            </div>
          </div>
        </div>
      </nav>
    </div>
    <!-- /top navigation -->

    <!-- hero  -->
    <div class="container-fluid hero-bg mt-3">
      <div class="container py-5">
        <h1 class="fw-bold">Path-Traversal</h1>
        <p class="fs-4 mb-0 text-light text-opacity-75">Challenge</p>
      </div>
    </div>
    <!-- /hero -->

    <div class="container">
      <div class="row mt-5">
        <!-- sidebar -->
        <div class="col-3">
          <div class="sidebar text-white">
            <ul>
              <li>
                <a
                  class="btn btn-dark w-100 p-3"
                  href="http://localhost:3000/index.html"
                  >Einführung</a
                >
              </li>
              <li>
                <a
                  class="btn btn-primary w-100 p-3"
                  href="http://localhost:3000/challenge.html"
                  >Challenge starten</a
                >
              </li>
              <li>
                <a class="btn btn-dark w-100 p-3" href="http://localhost:3001"
                  >Abgesicherte Challenge</a
                >
              </li>
              <li>
                <hr />
              </li>
              <li>
                <a
                  tabindex="1"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Statische Inhalte auf dieser Seite werden per NGINX-Location-Directives zur Verfügung gestellt. Fehlkonfigurationen von
                  NGINX-Location-Directives können Path-Traversal ermöglichen."
                >
                  Hinweis 1
                </a>
              </li>
              <li>
                <a
                  tabindex="2"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Zum Ausnutzen der Sicherheitslücke in dieser Challenge
                  lassen sich die Adressleiste des Browsers oder auch Tools wie 'curl' nutzen."
                >
                  Hinweis 2
                </a>
              </li>
              <li>
                <a
                  tabindex="3"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="In der Einführung steht etwas über 'Dot-Dot-Slash'-Sequenzen."
                >
                  Hinweis 3
                </a>
              </li>
              <li>
                <a
                  tabindex="4"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Das Verzeichnis 'secret' befindet sich auf der gleichen Ebene
                  wie der des Verzeichnises 'images', dass die Bilder der Seite enthält."
                >
                  Hinweis 4
                </a>
              </li>
              <li>
                <a
                  tabindex="5"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Im Verzeichnis 'secret' befindet sich eine Datei namens
                  'secret.json'. In dieser ist die Flag versteckt."
                >
                  Hinweis 5
                </a>
              </li>
              <li>
                <a
                  tabindex="6"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Um diese Datei zu öffnen kann
                  'http://localhost:3000/images../secret/secret.json' in die Adressleiste
                  des Browsers eingegeben werden."
                >
                  Hinweis 6
                </a>
              </li>
              <li>
                <a
                  tabindex="7"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Die Flag ist der Wert, der im Feld 'flag' steht."
                >
                  Hinweis 7
                </a>
              </li>
              <li>
                <a
                  tabindex="8"
                  class="btn btn-outline-info mb-2 w-100"
                  role="button"
                  data-bs-toggle="popover"
                  data-bs-placement="right"
                  data-bs-content="Die Flag ist 'flag_23_42_73'."
                >
                  Hinweis 8
                </a>
              </li>
              <li>
                <hr />
              </li>
              <li>
                <label class="form-label" for="path-traversal_level-1_flag"
                  >Flag hier überprüfen:</label
                >
                <input
                  class="form-control bg-dark text-light mb-2"
                  tabindex="9"
                  type="text"
                  name="path-traversal_level-1_flag_input"
                  id="path-traversal_level-1_flag_input"
                  placeholder="Flag hier eingeben"
                />
                <a
                  tabindex="10"
                  class="btn btn-outline-info w-100"
                  href="javascript:check_flag(document.getElementById('path-traversal_level-1_flag_input').value);"
                  >Flag überprüfen</a
                >
              </li>
              <li>
                <hr />
              </li>
              <li>
                <a
                  id="solution-button"
                  href="javascript:toggle_solution();"
                  tabindex="11"
                  class="btn btn-outline-danger w-100"
                  role="button"
                >
                  Lösung einblenden
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!-- /sidebar -->

        <div class="col-9">
          <div class="row">
            <h2 id="scrollspyGallery" class="huge">Galerie</h2>

            <div class="col-sm">
              <div class="card">
                <a href="/images/forking-forest-path.jpg"
                  ><img
                    src="/images/forking-forest-path.jpg"
                    class="card-img-top"
                    alt="Gabelung im Wald"
                  />
                </a>
              </div>
            </div>

            <div class="col-sm">
              <div class="card">
                <a href="/images/hidden-cat.jpg"
                  ><img
                    src="/images/hidden-cat.jpg"
                    class="card-img-top"
                    alt="Katze versteckt sich"
                /></a>
              </div>
            </div>

            <div class="col-sm">
              <div class="card">
                <a href="/images/key-dropped-in-the-woods.jpg"
                  ><img
                    src="/images/key-dropped-in-the-woods.jpg"
                    class="card-img-top"
                    alt="Schlüssel im Wald"
                /></a>
              </div>
            </div>

            <div class="col-sm">
              <div class="card">
                <a href="/images/black-printed-shirt.jpg"
                  ><img
                    src="/images/black-printed-shirt.jpg"
                    class="card-img-top"
                    alt="Schwarzes Print-Shirt"
                /></a>
              </div>
            </div>
            <div class="container mt-5">
              <hr />
              <h3 class="mt-4">Erklärung</h3>
              <p>
                Das hier ist eine einfache Galerie. Man kann auf die oben zu
                sehenden Bilder klicken, um diese im Browser in ihrer vollen
                Größe darzustellen. Um wieder zurück zur Galerie zu kommen, muss
                die Zurückfunktion des Browser benutzt werden.
              </p>
              <p>
                Die Bilder sind statische Dateien, die vom Webserver
                bereitgestellt werden, allerdings in einem anderen Verzeichnis
                als dem Web-Root gespeichert sind. Deshalb ist dieses
                Verzeichnis in der Konfiguration des Webservers per
                Location-Directive eingetragen.
              </p>
              <p>
                Die Flag ist ein String, der irgendwo in einer Datei auf dem
                Server als String gespeichert ist. Versuche die Flag zu finden!
                Sobald du glaubst, sie gefunden zu haben, gib sie hier in der
                Galerie im Feld "Flag hier überprüfen" ein. Falls du die
                korrekte Flag gefunden hast, wird dein Fortschritt auf der
                Hauptseite gespeichert.
              </p>
              <p>
                In der Seitenleiste auf der linken Seite können Hinweise zum
                Vorgehen ein- und ausgeblendet werden. Zum Ein- bzw. Ausblenden
                muss jeweils einmal der jeweilige Hinweis-Button betätigt
                werden.
              </p>
              <p>
                Falls nötig, lässt sich auch eine funktionierende Lösung
                einblenden.
              </p>

              <p>
                Wenn du die Challenge gemeistert hast, schau dir auch die
                <a href="http://localhost:3001">abgesicherte Challenge</a> an.
                Dort gibt es auch noch eine nähere Erklärung.
              </p>
              <p>Viel Erfolg!</p>
            </div>
            <div id="solution-section" class="container visually-hidden">
              <hr />
              <h3 class="mt-4">Lösung</h3>
              <p>
                Um die Fehlkonfigurationen der Location-Directives der in dieser
                Challenge bereitgestellten NGINX-Instanz ausnutzen zu können,
                kann man einfach die Adressleiste des Browsers nutzen und dort
                eine der bereits erwähnten "Dot-Dot-Slash"-Sequenzen eingeben.
                Beispielsweise kann
                <a href="http://localhost:3000/images../secret/secret.json"
                  >http://localhost:3000/images../secret/secret.json</a
                >
                in die Adressleiste des Browsers eingegeben werden, um die Flag
                aus der Datei "secret.json" auszulesen.
              </p>
              <p>
                Die Flag ist der Wert, der im Feld "flag" steht, also
                "flag_23_42_73". Diesen Wert gibt man im linken Textfeld zum
                Überpüfen der Flag ein und aktiviert die Schaltfläche "Flag
                überprüfen". Da das Verzeichnis "css" der selben
                Fehlkonfigurationen unterliegt, wie der "images" Ordner,
                funktioniert z.B. auch die URL
                <a href="http://localhost:3000/css../secret/secret.json"
                  >http://localhost:3000/css../secret/secret.json</a
                >
              </p>
              <p>
                Wenn du genauer wissen willst, warum das Ausnutzen von
                Path-Traversal hier möglich war Challenge gemeistert hast, schau
                dir auch die
                <a href="http://localhost:3001">abgesicherte Challenge</a> an.
                Dort funktioniert der Exploit nicht mehr und es gibt auch noch
                eine nähere Erklärung.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- enable and configure bootstrap popovers -->
    <script>
      var popoverTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="popover"]')
      );
      var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
      });
      var popover = new bootstrap.Popover(
        document.querySelector(".hint-popover"),
        {
          container: "body",
        }
      );
    </script>
    <!-- enable and configure bootstrap popovers -->

    <!-- flag checking -->
    <script>
      // make backend call to check flag
      const check_flag = (flag) => {
        const xhr = new XMLHttpRequest();
        const xhr_method = "POST";
        const xhr_url = "http://localhost/check-flag";
        const xhr_async = true;
        const xhr_payload = {
          challenge_name: "path-traversal_level-1",
          challenge_flag: flag,
        };

        console.log("xhr_payload", xhr_payload);

        xhr.open(xhr_method, xhr_url, xhr_async);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = () => {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            console.log("xhr.response", xhr.response);
            show_flag_check_result(JSON.parse(xhr.response).is_flag_correct);
          }
        };

        xhr.send(JSON.stringify(xhr_payload));
      };

      // show result of flag checking to user
      const show_flag_check_result = (result) => {
        const correct_result = 1;

        if (result === correct_result) {
          alert(
            "Gratulation, die Flag ist korrekt :)\n\nDein Fortschritt wurde gespeichertund ist jetzt auf der Startseite sichtbar."
          );
        } else {
          alert(
            "Das ist leider NICHT die korrekte Flag :(\n\nVersuch es weiter!"
          );
        }
      };

      // enter keypress in flag check input field calls check_flag function
      const flag_input_box = document.getElementById(
        "path-traversal_level-1_flag_input"
      );
      flag_input_box.onkeydown = function (e) {
        if (e.key == "Enter") {
          e.preventDefault();
          check_flag(flag_input_box.value);
        }
      };
    </script>
    <!-- flag checking -->

    <script>
      const toggle_solution = () => {
        const solution_section = document.getElementById("solution-section");
        const solution_button = document.getElementById("solution-button");

        // class="btn btn-outline-danger w-100"

        if (solution_section.classList.contains("visually-hidden")) {
          solution_section.classList.remove("visually-hidden");
          solution_button.innerHTML = "Lösung ausblenden";
        } else {
          solution_section.classList.add("visually-hidden");
          solution_button.innerHTML = "Lösung einblenden";
        }
      };
    </script>
  </body>
</html>
