import os
import subprocess

from flask import Flask, render_template, request, render_template_string, flash

app = Flask(__name__)


@app.route("/command_injection_1")
def command_injection_1():
    return render_template("command_injection_1.html", result="")


@app.route("/command_injection_1_fixed")
def command_injection_1_fixed():
    return render_template("command_injection_1_fixed.html", result="")


@app.route("/command_injection_1", methods=["POST"])
def command_injection_1_post():
    name = request.form["name"]
    try:
        result = subprocess.check_output(
            f"echo Hallo {name}, ich habe dich bereits erwartet.", shell=True
        )
        return render_template(
            "command_injection_1.html", result=result.decode("utf-8")
        )
    except subprocess.CalledProcessError as e:
        print(e)
        return render_template(
            "command_injection_1.html", result="Dieser text existiert nicht."
        )
    # solution ;cat ~/passwordLVL1.txt #


@app.route("/command_injection_1_fixed", methods=["POST"])
def command_injection_1_post_fixed():
    return render_template(
        "command_injection_1_fixed.html",
        result=f"Hallo {request.form['name']}, ich habe dich bereits erwartet.",
    )


if __name__ == "__main__":
    app.run(host="0.0.0.0")
