<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server-Site-Template-Injection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <script>
        function give_hint(hint) {
            document.getElementById("hint_msg").innerHTML = hint;
        }
    </script>


</head>

<body>
    <div class="grid-container">
        {% include 'toc.html' %}
        <div class="grid-item grid-item-3">
            <form action="{{ url_for('ssti_1')}}" method="GET">
                <p>Die Flag für diese Herausforderung ist in ~/passwordLVL2.txt gespeichert. Versuche es
                    auszulesen.</br>Nutze
                    das untere Eingabefeld um die Command-Injection auszuführen.</br>Nutze die Hinweise, falls du nicht
                    weiterkommst.</br>Nach erfolgreicher Command-Injection erhälts du eine Flag. Gebe diese in das
                    untere
                    Eingabefeld ein, um die Challenge zu bestehen.</p>
                <hr>
                <p>Gebe eine Farbe in HEX ein und erhalte die RGB-Werte.</p>
                <input type="text" name="hex" />
                <input type="submit" value="eingeben" />
            </form>

            <button
                onclick="give_hint('Die Webapp benutzt Flask und damit die Jinja2-Template-Engine. Diese nutzt &#123;&#123;AUSDRUCK&#125;&#125; um Jinja2-Syntax vom Rest des Templates zu unterscheiden.')">Hinweis
                1</button>
            <button
                onclick="give_hint('Wir brauchen einen Einstiegspunkt für die Injection. Hierfür kann beispielsweise url_for genutzt werden, das oft in Flask-Webapps genutzt wird.')">Hinweis
                2</button>
            <button onclick="give_hint('Wir brauchen einen Weg, um das os Python module zu importieren.')">Hinweis
                3</button>
            <button
                onclick="give_hint('Man kann url_for.__class.__base__.__subclasses__() nutzen, um sich alle Subclasses anzeigen zu lassen. Vielleicht kann eines davon das os Modul laden.')">Hinweis
                4</button>
            <button
                onclick="give_hint('Man kann ein Submodul aus der Liste mit [INDEX] wählen. Welche Klasse könnte os importieren?')">Hinweis
                5</button>
            <button
                onclick="give_hint('Die Klasse _frozen_importlib.BuiltinImporter hat eine Methode load_module(&quot;MODULE&quot;), die das os Modul laden kann.')">Hinweis
                6</button>
            <button
                onclick="give_hint('Das os Modul hat die Methode popen(&quot;cat FILE&quot;).read() mit der man die Zieldatei lesen kann.')">Hinweis
                7</button>
            <button
                onclick="give_hint('Eine mögliche Lösung lautet:<br>&#123;&#123;url_for.__class__.__base__.__subclasses__()[84].load_module(&quot;os&quot;).popen(&quot;cat ~/passwordLVL2.txt&quot;).read()&#125;&#125;<br>Die &#123;&#123;&#125;&#125; sagen der Template-Engine, dass die Eingabe als Template betrachtet und somit ausgeführt werden soll.<br>Der darin enthaltene Code ist in Python, da das die verwendete Backendsprache ist.<br>url_for.__class__.__base__.__subclasses__()[84] nutzt die in der Template-Engine verwendete Methode url_for als Einstiegspunkt, um Zugriff auf die Klasse _frozen_importlib.BuiltinImporter zu bekommen.<br>Diese wird dann genutzt, um das os Modul zu importieren, das Zugriff auf Betriebssystemfunktionen erlaubt.<br>Das wird auch gleich ausgenutzt, um cat auszuführen und so die Datei auszulesen.')">Lösung
            </button>

            <p id="hint_msg">{{result}}</p>
        </div>
    </div>



</body>

</html>