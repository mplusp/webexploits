<!DOCTYPE html>
<?php $round = 0;
$round_stand = 0;

?>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- Important to make website responsive -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="http://localhost/sql-injection/src/index.php" />
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <form action="index.php" method="POST" id="f">

        <input type="checkbox" id="flag1" name="check" />
        <input type="checkbox" id="flag2" name="check" />
        <input type="checkbox" id="checkbox" name="check_round1" <?php include 'conn.php';
                                                                    echo ($round == 2 | $round == 3) ? ' disabled="disabled"' : '';
                                                                    ?> />
        <input type="checkbox" id="checkbox2" name="check_round2" <?php include 'conn.php';
                                                                    //echo ($round != 2) ? ' disabled="disabled"' : '';
                                                                    ?> />
        <input type="checkbox" id="checkbox3" name="check_round3" <?php include 'conn.php';
                                                                    // echo ($round != 3) ? ' disabled="disabled"' : '';
                                                                    ?> />


        <div class=" title">
            <div class="inhalt">
                <h1> WEB Exploitation</h1>
            </div>
        </div>

        <div class="box">
            <h1> SQL-Injection</h1>
            <ul>
                <li><button type="submit" name="stufe1"> Stufe 1 </button>

                </li>
                <li><span style="color:#0c2461">Stufe 2</span>
                    <label for="flag1" class="flag1">ROUND1</label>
                </li>
                <li><span style="color:#0c2461">Stufe 3</span>
                    <label for="flag2" class="flag2">ROUND1</label>
                </li>
            </ul>
        </div>

        <div class="rahmen">

            <div class="box">

                <div class="auswahl">
                    <div class="auswahl2">
                        <?php



                        if (isset($_POST['check_round1']) | isset($_POST['check_round2']) | isset($_POST['check_round3'])) {
                            $check = isset($_POST['check_round1']) ? 0 : 1;
                            $check1 = isset($_POST['check_round2']) ? 0 : 1;
                            $check2 = isset($_POST['check_round3']) ? 0 : 1;
                            $array = array($check, $check1, $check2);
                            foreach ($array as $v) {
                                if ($v != 0) {
                                    $disabled = 1;
                                }
                                $disabled = 0;
                            }
                        }
                        $status = false;
                        if ((isset($_POST['stufe1'])) | (isset($_POST['login']))) {
                            echo '<div class = "chall1"><strong>Challenge 1: Entdeckung einer SQL-Injection-Sicherheitslücke mit Login-Funkionalität</strong></div>';

                            echo "<br/> <br/>";
                        }
                        ?>
                    </div>
                    <?php
                    if ((isset($_POST['flag_btn']))) {
                        include 'check_flags.php';
                    }
                    ?>
                    <div class=" s">
                        <?php
                        $count = 1;
                        if ((isset($_POST['stufe1'])) | (isset($_POST['login']))) {
                            echo '<div class="round">  Runde 1
                            <label for="checkbox" class="begin">ROUND1</label>  </div>';

                            echo ' <div class="round"> Runde 2 <label for="checkbox2" class="begin2">ROUND2</label> </div> ';

                            echo ' <div class="round"> Runde 3 <label for="checkbox2" class="begin3">ROUND3</label></div>';
                            include 'conn.php';
                            include 'sql_select.php';
                            if ($status == false) {
                                include 'ausgabe.php';
                            }
                            do {
                                if (isset($_POST['cancel'])) {
                                    exit;
                                }
                            } while (0);
                        } ?>
                        <?php if ($status == true) {
                            if ($round == 2 | $round == 3) {
                                echo "</br>";
                                echo '<div id ="erg" style="color:green; position: absolute;margin: -18px 175px;"> <h3> Glückwunsch! </h3> </div>';
                                echo '<div id ="check_1" style="color:green;  position: absolute; margin: -183px 122px;"> <h2> ✓</h2></div>';

                                if ($round == 3) {
                                    echo '<div id ="check_1" style="color:green; color:green; position: absolute;margin: -183px 293px;"> <h2> ✓</h2></div>';
                                }
                            } else {
                                echo '<div id="erg" ><h2> Falsche Eingabe!</h2> </div>';
                            }
                        }
                        ?>


                    </div>

                </div>

            </div>
        </div>

        <div class="flag_popup">
            <div class="flag_eingabe">
                <input type="text" id="flag_text" name="flag_eingabe" autocomplete="off"
                    placeholder="Geben sie Flag ein" style="width: 322px;
height: 40px; margin: 1px 20px; ">
            </div>
            <div class="flag_btn">
                <input type="submit" name="flag_btn" value="submit"
                    style="  height: 40px;width: 350px; margin: 10px 30px;
  background: #00dbff52; border-top-right-radius: 10px; border-top-left-radius: 10px;border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;">
            </div>
        </div>


        <div class="popup">

            <input type="submit" name="cancel" class="cancel" value="x">

            <label for="checkbox" class="cancel"> </label>
            <div class="round"> Runde
                <?php
                echo $round . "-3";
                ?>
            </div>
            <div class="inhalt"> <strong> <?php include 'conn.php';

                                            if ($round == 1) {
                                                echo "SQL-Injektionen können manuell erkannt werden, indem man systematische Tests
                                                durchführt. Finden Sie heraus! Log als admin ein.";
                                            } else if ($round == 2) {
                                                echo "Ein wahres statement produziert immer wahres Statement <br />Z.b. OR 1=1";
                                            } else if ($round == 3) {
                                                echo "Dieses Zitat  '  Charakter ist mit der Abfrage interferiert. Kombiniere dieses Zeichen mit anderen Runden. Erhalt dann den Flag.  <br />";
                                            }
                                            ?> </strong></div>

            <div class="name">
                <input type="text" name="username" placeholder="username" autocomplete="off">
                <input type="password" name="password" placeholder="Password">
            </div>
            <div class="btn">
                <input type="submit" name="login" value="login">
            </div>
    </form>
    <div class=" text">
    </div>

    <div class="hint">
        <ul>
            <p>Hinweise:</p>
            <li>
                <div class="content">
                    <h3>Überspringen</h3>
                    <p> wenn sie lösungen wissen, kann ab erste round Stufe 2 erreichen. <br /> </p>
                </div>

            </li>
            <li>
                <div class="content">
                    <h3> -- charactor</h3>
                    <p> Comment Charactor ignoriert in SQL den Rest der Abfrage</p>
                </div>
            </li>
            <li>
                <div class="content">
                    <h3>Suche mit boolescher Bedingungen</h3>
                    <p> Ein wahres statement produziert immer wahres Statement <br />Z.b. OR 1=1 </p>
                </div>

            </li>

        </ul>
    </div>
    </div>
    </form>

</body>

</html>